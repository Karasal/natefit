# NATEFIT Progress

## Current Status: Full Trainer CRM Built (All 10 Phases)

## Architecture
```
iOS App (Swift/ARKit)     Web App (Next.js)
  RGB + LiDAR depth         RGB only
         \                    /
          \                  /
    GPU Backend (Python/FastAPI on Modal)
    HMR 2.0 → SMPL → Measurements → Body Comp
                  |
            Supabase (Auth, DB, Realtime, Storage)
                  |
    ┌─────────────┼──────────────┐
    │ Stripe      │ Resend       │
    │ (Payments)  │ (Email)      │
    └─────────────┴──────────────┘
```

## What's Done

### Foundation
- [x] Project scaffold (Next.js 16, TypeScript, Tailwind v4)
- [x] Design system (dark athletic aesthetic, globals.css, all UI components)
- [x] Database schema (profiles, orgs, clients, scans, measurements, goals)
- [x] Supabase integration (client, server, middleware, RLS policies)
- [x] Auth flow (login, signup, magic link, callback)
- [x] Dashboard + Portal layouts and pages
- [x] Landing page + Pricing page
- [x] Measurement visualization components

### GPU Backend (backend/)
- [x] Full SMPL pipeline (HMR 2.0 → optimize → measure → body comp)
- [x] Modal serverless GPU deployment (A100, scales to zero)
- [x] LiDAR depth processing + point cloud scaling

### iOS LiDAR App (ios/NateFit/)
- [x] Swift/ARKit capture, pose guide, API client, results view

### CRM Infrastructure (Phase 1)
- [x] Migration 004: analytics RPC, profile fields, goals improvements, scan tokens
- [x] OrganizationProvider with useOrganization() hook
- [x] Admin Supabase client (service role)
- [x] Service layer: clientService, scanService, measurementService, goalService, orgService, analyticsService
- [x] Dashboard with real metrics (total clients, active, scans, avg BF)
- [x] Settings page (Profile, Organization, Team, Billing tabs)
- [x] Client edit/delete modals with TagInput
- [x] Scan detail pages (trainer + client views)

### Client Experience (Phase 2)
- [x] Invite flow (Resend email, acceptance page, signup integration)
- [x] Bulk invite modal (multi-email, CSV upload)
- [x] Client onboarding wizard (3-step: Body Stats → Fitness Profile → Welcome)
- [x] Goals management UI (trainer + client views)
- [x] GoalCard, GoalFormModal, GoalProgressBar components
- [x] useClientProgress hook
- [x] Public scan page (/scan/[token]) for unauthenticated clients
- [x] Portal compare page (side-by-side scan comparison)
- [x] Portal profile page (self-edit)

### Workout Programming (Phase 3)
- [x] Migration 005: exercise library (6 tables), programming (7 tables), logging (3 tables), PRs, progression
- [x] exerciseService, programService, workoutService
- [x] Exercise library UI (browse, search, create, detail, edit)
- [x] ExerciseCard, ExerciseSearch, ExercisePicker components
- [x] Program builder (list, create wizard, full editor)
- [x] ProgramBuilder, PhaseNav, DayEditor, BlockEditor, SetRow, BlockTypeSelector
- [x] AssignProgramModal, ProgramCard
- [x] Workout execution (live logging with rest timer, PR detection)
- [x] WorkoutExecution, SetLogger, RestTimer, WorkoutSummary, WorkoutCalendar, PRBadge
- [x] Portal workout page, workout review, program overview
- [x] Trainer client program view with feedback

### Video & Content (Phase 4)
- [x] Migration 009: video_content, resources tables
- [x] Content management page (videos + resources tabs)
- [x] Content upload page
- [x] Portal library page (client sees published content)

### Nutrition & Habits (Phase 5)
- [x] Migration 006: nutrition_targets, meal_plans, food_logs, habits, habit_logs
- [x] nutritionService, habitService
- [x] MacroRings, FoodLogEntry, NutritionChart components
- [x] HabitCheckbox, StreakBadge, HabitGrid components
- [x] Portal nutrition page (food logging + macro tracking)
- [x] Portal habits page (daily checklist + streaks)
- [x] Trainer nutrition view (targets, compliance, food logs)

### Communication & Check-ins (Phase 6)
- [x] Migration 007: conversations, messages, check-ins, notifications, auto-messages
- [x] messageService, notificationService, checkInService
- [x] ConversationList, MessageThread, MessageInput, MessageBubble
- [x] NotificationBell component
- [x] Dashboard messages page (two-column layout)
- [x] Portal messages page (single conversation with trainer)
- [x] Check-in template builder + response viewer
- [x] Portal check-in page (fill out + history)

### Billing & Payments (Phase 7)
- [x] Stripe integration (server + client, checkout, portal, webhooks)
- [x] Plan guard (feature gating by tier)
- [x] Products page (create one-time/recurring products)
- [x] Plan config: Starter $0/5, Pro $29/unlimited, Studio $59/team+whitelabel

### Team Management (Phase 8)
- [x] Migration 008: team_invites, activity_log, products, purchases, appointments
- [x] Team page (member list, role management, invite)

### Scheduling (Phase 10)
- [x] Schedule page (week bar, appointment list, create modal)

### Build Status
- [x] TypeScript: 0 errors
- [x] Next.js build: passes, 53 routes registered
- [x] All API routes functional

## Route Inventory (53 routes)

### Dashboard (16 routes)
/dashboard, /dashboard/clients, /dashboard/clients/new, /dashboard/clients/[id],
/dashboard/clients/[id]/goals, /dashboard/clients/[id]/nutrition, /dashboard/clients/[id]/program,
/dashboard/clients/[id]/scans/[sid], /dashboard/programs, /dashboard/programs/new,
/dashboard/programs/[id]/edit, /dashboard/exercises, /dashboard/exercises/new,
/dashboard/exercises/[id], /dashboard/content, /dashboard/content/upload,
/dashboard/messages, /dashboard/check-ins, /dashboard/schedule, /dashboard/team,
/dashboard/products, /dashboard/settings, /dashboard/scan/[clientId]

### Portal (14 routes)
/portal, /portal/workout, /portal/workout/[logId], /portal/nutrition, /portal/habits,
/portal/messages, /portal/profile, /portal/goals, /portal/compare, /portal/library,
/portal/check-in, /portal/history, /portal/history/[scanId], /portal/onboarding,
/portal/program, /portal/scan

### API (8 routes)
/api/auth/callback, /api/invite/send, /api/scan-token, /api/scan/process,
/api/scan/public, /api/stripe/checkout, /api/stripe/portal, /api/webhooks/stripe

### Public (4 routes)
/, /login, /signup, /pricing, /invite/[token], /scan/[token]

## Database Migrations
- 001: Initial schema (profiles, orgs, org_members, clients, scans, measurements, goals)
- 003: Mesh data + scan tier
- 004: CRM infrastructure (analytics RPC, profile fields, scan tokens)
- 005: Workout engine (exercises, programs, logging, PRs)
- 006: Nutrition + habits
- 007: Messaging + check-ins + notifications
- 008: Billing + team + scheduling
- 009: Content + groups + branding

## Trainerize Feature Parity (In Progress)

### Phase 1: Exercise Library + Compliance Tracking
- [ ] Pre-built exercise library (300+ exercises seed data + admin API route)
- [x] Compliance tracking service (complianceService.ts — workout/nutrition/habit rates)
- [x] Compliance dashboard widget (ComplianceWidget.tsx — ring charts + at-risk clients)
- [x] Per-client compliance page (/dashboard/clients/[id]/compliance)

### Phase 2: Automated Messages + PDF Reports
- [ ] Migration 010: automation_rules table
- [ ] automationService (CRUD + rule evaluation)
- [ ] Cron route for time-based triggers (birthday, inactivity)
- [ ] Dashboard automations page (rule builder UI)
- [ ] PDF progress reports (@react-pdf/renderer)
- [ ] Reports API endpoint + download button

### Phase 3: Client Self-Booking + Group Messaging
- [ ] Migration 011: booking_config + appointments extensions
- [ ] bookingService (availability, booking, cancellation)
- [ ] Portal schedule page (client self-booking)
- [ ] Migration 012: group messaging on conversations
- [ ] Group/broadcast messaging UI

### Phase 4: Branding + Google Calendar
- [ ] Branding settings UI (logo, colors, custom domain)
- [ ] useBranding hook + dynamic portal theming
- [ ] Migration 013: calendar_connections
- [ ] Google Calendar OAuth + two-way sync

### Phase 5: AI Workout + AI Meals (Gemini)
- [ ] Gemini API client (@google/generative-ai)
- [ ] AI workout generator + API route
- [ ] AIGenerateModal for programs page
- [ ] AI meal plan generator + API route
- [ ] Portal meal plan page

### Phase 6: Content Monetization + Wearables
- [ ] Migration 014: content monetization (product_id, content_access)
- [ ] contentAccessService (gating + purchase)
- [ ] Migration 015: wearable integrations (Garmin, Fitbit, Withings)
- [ ] OAuth flows + data sync for wearables
- [ ] Portal integrations page

### Phase 7: PWA + Push Notifications
- [ ] Migration 016: push_subscriptions
- [ ] Service worker (serwist)
- [ ] Web manifest + install prompt
- [ ] Web-push notifications (VAPID)
- [ ] Offline support

## What's Next (Remaining Polish)

### Before Launch
- [ ] Download + configure model weights (HMR 2.0, SMPL, MLP)
- [ ] Deploy backend to Modal (`modal deploy modal_deploy.py`)
- [ ] Set SCAN_API_URL env var in Vercel
- [ ] Run database migrations 003-009
- [ ] Set Stripe env vars (secret key, webhook secret, price IDs)
- [ ] Set Resend API key
- [ ] Xcode project setup for iOS app

### Scan Validation
- [ ] Recruit 10-20 test subjects
- [ ] Compare NATEFIT measurements vs tape
- [ ] Target: <2cm MAE (LiDAR), <3cm MAE (photo)
